<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>HICAMP VMS</title>
  <link href="assets/css/bootstrap.min.css" rel="stylesheet">
  <script src="assets/js/jquery-2.2.0.min.js"></script>
  <script src="assets/js/bootstrap.min.js"></script>
</head>

<style>
  #myModal {
    display: block;
    top: 20%;
  }

  #submit {
    width: 100%;
  }

  #container {
    margin-top: 60px;
  }

  .nav-tabs a {
    font-size: 18px;
  }

</style>

<body>

<nav class="navbar navbar-default navbar-fixed-top">
  <div class="container">
    <div class="navbar-header">
      <ul class="nav nav-tabs">
        <li role="presentation" class="active"><a href="#">添加</a></li>
        <li role="presentation"><a href="./list.html">已添加</a></li>
        <li role="presentation"><a href="./daoList.html">导出</a></li>
      </ul>
    </div>
    <a class="navbar-brand navbar-right" href="./index.html">注销</a>
  </div>
</nav>
<div class="container" id='container'>
  <form action="/vms/add" method="post" enctype="multipart/form-data" id='myform'>
    <div class="form-group">
      <label for="name">资源名称</label>
      <input type="text" class="form-control" id="name" name="name" placeholder="请输入资源名称" required>
    </div>
    <div class="form-group">
      <label for="contentcode">资源id</label>
      <input type="text" class="form-control" id="contentcode" name="contentcode" placeholder="请输入资源id" disabled>
    </div>
    <div class="form-group">
      <label for="contentpath">资源路径</label>
      <input type="text" class="form-control" id="contentpath" name="contentpath" placeholder="请输入资源的完整路径" required>
    </div>

    <div class="form-group">
      <label for="copyright">版权信息</label>
      <input type="text" class="form-control" id="copyright" name="copyright" placeholder="请输入资源的版权信息" value='土星成长'>
    </div>

    <div class="form-group">
      <label for="isAlbum">是否为专辑</label>
      <select id="isAlbum" class="form-control" name='isAlbum'>
        <option value="1" selected>是</option>
        <option value="0">否</option>
      </select>
    </div>
    <div class="form-group">
      <label for="summary">资源摘要</label>
      <input type="text" class="form-control" id="summary" name="summary" placeholder="请输入资源摘要">
    </div>
    <div class="form-group">
      <label for="train_options_container">资源标签</label>
      <div class="form-inline" id="train_options_container">
        <div class="checkbox"><label><input type="checkbox" value="课程" v="课程"> 课程</label></div>
        <div class="checkbox"><label><input type="checkbox" value="人格" v="人格"> 人格</label></div>
        <div class="checkbox"><label><input type="checkbox" value="英语" v="英语"> 英语</label></div>
        <div class="checkbox"><label><input type="checkbox" value="语言" v="语言"> 语言</label></div>
        <div class="checkbox"><label><input type="checkbox" value="科幻" v="科幻"> 科幻</label></div>
        <div class="checkbox"><label><input type="checkbox" value="儿歌" v="儿歌"> 儿歌</label></div>
        <div class="checkbox"><label><input type="checkbox" value="社交" v="社交"> 社交</label></div>
        <div class="checkbox"><label><input type="checkbox" value="理念" v="理念"> 理念</label></div>
        <div class="checkbox"><label><input type="checkbox" value="科普" v="科普"> 科普</label></div>
        <div class="checkbox"><label><input type="checkbox" value="冒险" v="冒险"> 冒险</label></div>
        <div class="checkbox"><label><input type="checkbox" value="兴趣" v="兴趣"> 兴趣</label></div>
        <div class="checkbox"><label><input type="checkbox" value="亲子" v="亲子"> 亲子</label></div>
        <div class="checkbox"><label><input type="checkbox" value="国外" v="国外"> 国外</label></div>
        <div class="checkbox"><label><input type="checkbox" value="国学" v="国学"> 国学</label></div>
        <div class="checkbox"><label><input type="checkbox" value="绘本" v="绘本"> 绘本</label></div>
        <div class="checkbox"><label><input type="checkbox" value="认知" v="认知"> 认知</label></div>
        <div class="checkbox"><label><input type="checkbox" value="动画" v="动画"> 动画</label></div>
        <div class="checkbox"><label><input type="checkbox" value="习惯" v="习惯"> 习惯</label></div>
        <div class="checkbox"><label><input type="checkbox" value="故事" v="故事"> 故事</label></div>
        <div class="checkbox"><label><input type="checkbox" value="功夫" v="功夫"> 功夫</label></div>
        <div class="checkbox"><label><input type="checkbox" value="诗词" v="诗词"> 诗词</label></div>
        <div class="checkbox"><label><input type="checkbox" value="艺术" v="艺术"> 艺术</label></div>
        <div class="checkbox"><label><input type="checkbox" value="健康" v="健康"> 健康</label></div>
      </div>
    </div>
    <div class="form-group">
      <label for="minAge">最小年龄</label>
      <input type="number" class="form-control" value='1' id="minAge" name="minAge" min="0" max="6">
    </div>
    <div class="form-group">
      <label for="maxAge">最大年龄</label>
      <input type="number" class="form-control" value='6' id="maxAge" name="maxAge" min="1" max="6">
    </div>
    <div class="form-group">
      <label for="vip">会员</label>
      <select id="vip" class="form-control" name='vip'>
        <option value="1" selected>会员</option>
        <option value="0">免费</option>
      </select>
    </div>
    <div class="form-group">
      <label for="score">资源评分</label>
      <input type="number" class="form-control" value='9' id="score" name="score" min="0" max="10">
    </div>
    <div class="form-group">
      <label for="posterLarge">大海报</label>
      <input type="file" id="posterLarge" name="posterLarge" required>
    </div>
    <div class="form-group">
      <label for="posterSmall">小海报</label>
      <input type="file" id="posterSmall" name="posterSmall">
    </div>
    <button type="submit" class="btn btn-primary">点击添加</button>
  </form>
</div>
</body>
<script>
  document.getElementById("myform").onsubmit = function (e) {
    //按钮禁用
    $('button[type="submit"]').prop('disabled', true).text('正在添加')
    e.preventDefault()
    //处理复选框的值
    var tags = []
    $('input[type="checkbox"]:checked').each(function () {
      if ($(this).val()) tags.push($(this).val())
    })

    var f = e.target
    var formData = new FormData(f)
    formData.append('tags', JSON.stringify(tags))

    var xhr = new XMLHttpRequest()
    xhr.open("POST", f.action)
    xhr.upload.onprogress = function (e) {
      console.log(e.total)
      console.log(e.lengthComputable)
      console.log(e.loaded)
    }
    xhr.onload = function () {
      var res = JSON.parse(this.responseText)
      if (res.code === 200) {
        alert(res.msg)
        window.location.reload()
      } else {
        alert(res.msg)
      }
      $('button[type="submit"]').prop('disabled', false).text('点击添加')

      if (res.code === 401) {
        alert(res.msg)
        window.location.replace('./index.html')
      }
    }
    xhr.onabort = function () {
      alert('添加失败')
      $('button[type="submit"]').prop('disabled', false).text('点击添加')
    }
    xhr.send(formData)

  }
</script>
</html>